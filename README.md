# Run simulations testing variance propagation

In order to setup the simulations, several pieces of code are used to generate data, build models and then finally run the simulation. Files which need to be run in order are numbered, those which are called from them (e.g., support functions) are unnumbered. Several `RData` files are generated during the setup process.

The main simulation `4_scrubsim.R` will run all simulations in parallel where possible. This is *extremely* memory/processor hungry. We do not recommend just running all of these scripts in order without some thought about the potential memory footprint.

Due to parallelisation (and it's interaction with Nimble) some of the code here is written in a slightly convoluted way. We apologise for this!

File/folder descriptions:

- `0_smoother_setup.R` uses `mgcv::jagam` to setup smoothers and data for the fully Bayesian model. Code outputs to `jagstemplate.jags` (already integrated into `nimble_setup.R`) and data to `jagsbits.RData` (needed later).
- `1_proposed_detfcts.R` saves and plots the proposed detection functions to be used in the simulation. Outputs `df_pars.RData`
- `2_nimble_setup.R` generates the objects needed by Nimble to fit the model, based on the JAGS code generated by `0_smoother_setup.R`. Outputs `nimble_setup.RData`.
- `3_scrubsim_setup.R` generate constant parts of the simulation: point locations, object locations, distances from objects to samplers. Outputs to `sim_env.RData`.
- `4_scrubsim.R` runs the simulations (see above caveats about parallel code).
- `support_functions.R` includes various support functions for the simulation.
- `results_csvs/` results used to generate plots etc from our runs of the simulation, output from the above scripts happens in the top level directory, these results are kept separate to avoid being overwritten.

